# Отчет по лабораторной работе №7
## "Создание клиент-серверного приложения на Python (MVC, HTTPServer, Jinja2)"

**Выполнил:** Студент группы ИВТ 2-1, Стажков Данила  
**Предмет:** Программирование на Python

---

### 1. Цель работы
Создать простое клиент-серверное приложение на Python без использования веб-фреймворков (Django/Flask). 
Задачи:
- Освоить работу с библиотекой `http.server` и маршрутизацию запросов.
- Применить архитектурный паттерн MVC (Model-View-Controller).
- Использовать шаблонизатор Jinja2 для рендеринга HTML.
- Реализовать работу с внешним API (ЦБ РФ) для получения курсов валют.
- Реализовать отображение графиков динамики курсов (самостоятельная работа).

### 2. Описание предметной области
В проекте реализованы следующие сущности (Модели):

*   **App**: Информация о приложении (название, версия, автор).
*   **Author**: Информация о разработчике.
*   **User**: Пользователь сервиса (имеет ID и имя).
*   **Currency**: Валюта (код, название, номинал, текущий курс).
*   **UserCurrency**: Связь пользователя и валют (подписки).

Все модели инкапсулируют данные и предоставляют доступ через свойства (`@property`) с валидацией типов.

### 3. Структура проекта
Проект организован в соответствии с паттерном MVC:

lab_python/
├── controllers/            # Контроллеры (Логика обработки запросов)
│   ├── app_controller.py   # Главная страница и страница автора
│   ├── user_controller.py  # Список пользователей и детальная страница
│   └── currency_controller.py # Список валют
├── models/                 # Модели (Данные)
│   ├── app.py
│   ├── author.py
│   ├── user.py
│   ├── currency.py
│   └── ...
├── templates/              # Представления (HTML-шаблоны Jinja2)
│   ├── base.html           # Базовый шаблон (меню, футер)
│   ├── index.html
│   ├── users.html
│   ├── user_detail.html    # Страница с графиками
│   └── currencies.html
├── utils/                  # Утилиты
│   └── currencies_api.py   # Парсинг XML с сайта ЦБ РФ
└── myapp.py                # Точка входа (Запуск сервера и маршрутизация)


text

### 4. Описание реализации

#### 4.1 Модели
Модели реализованы как Python-классы. Используются аннотации типов (`typing`) и Docstrings в формате PEP-257.
Пример валидации в модели `User`:
@name.setter
def name(self, value: str):
if not isinstance(value, str):
raise TypeError("Имя должно быть строкой")
self._name = value

text

#### 4.2 Сервер и Маршрутизация
Сервер реализован на базе стандартного `http.server.HTTPServer`. 
В файле `myapp.py` класс-обработчик разбирает URL (`self.path`) и в зависимости от пути вызывает нужный контроллер.
Поддержаны маршруты:
- `/` — Главная.
- `/users` — Список пользователей.
- `/user?id=...` — Детальная страница пользователя.
- `/currencies` — Таблица курсов.
- `/author` — Информация об авторе.

#### 4.3 Шаблонизация (Jinja2)
Инициализация `Environment` происходит один раз при старте сервера. Шаблоны наследуются от `base.html`, что позволяет избежать дублирования кода (меню и стили Bootstrap подключены один раз).

#### 4.4 Интеграция API
В файле `utils/currencies_api.py` реализована функция `get_currencies`, которая:
1. Делает запрос к `https://www.cbr.ru/scripts/XML_daily.asp`.
2. Парсит полученный XML с помощью `xml.etree.ElementTree`.
3. Преобразует строковые значения (с запятой) в `float` и возвращает список словарей.

### 5. Самостоятельная работа: Графики
Реализовано отображение динамики курсов валют на странице пользователя.
1. **Backend**: Функция `get_history` запрашивает данные у ЦБ РФ за последние 90 дней.
2. **Frontend**: Данные передаются в шаблон в формате JSON. Для визуализации используется JavaScript-библиотека **Chart.js**.

### 6. Вывод
В ходе работы было создано работоспособное веб-приложение. 
- Изучен принцип работы протокола HTTP и ручная обработка запросов.
- Реализовано четкое разделение логики и отображения (MVC).
- Приложение успешно получает и обрабатывает данные от внешнего сервиса (ЦБ РФ).
